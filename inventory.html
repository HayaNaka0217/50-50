<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>在庫管理</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    input[type="number"] {
      width: 60px;
    }
    button {
      margin: 2px;
      padding: 5px 10px;
    }
    .shortage {
      color: red;
      font-weight: bold;
    }
    .red-button {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
    }
    .red-button:hover {
      background-color: #c62828;
    }
  </style>
</head>
<body>
<button class="back-button" onclick="location.href='index.html'">← 部活選択に戻る</button>
<h1 id="clubTitle">在庫管理</h1>

<div style="margin-bottom: 10px;">
  <button onclick="showAll()">すべて表示</button>
  <button class="red-button" onclick="showShortage()">不足だけ表示</button>
</div>

<table id="inventory">
  <thead>
    <tr>
      <th>商品名</th>
      <th>個数</th>
      <th>必要個数</th>
      <th>入荷</th>
      <th>消費</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>新規追加</h2>
<input type="text" id="newName" placeholder="商品名" />
<input type="number" id="newQty" placeholder="個数" min="0" />
<input type="number" id="newRequiredQty" placeholder="必要個数" min="0" />
<button onclick="addItem()">追加</button>

<script>
  // クエリから部活名取得
  const urlParams = new URLSearchParams(window.location.search);
  const clubName = urlParams.get("club") || "default";
  const STORAGE_KEY = `inventory_${clubName}`;

  const clubTitleMap = {
    soccer: "サッカー部",
    baseball: "野球部",
    softball: "ソフトボール部",
    basketball: "バスケットボール部",
    vallyball: "バレーボール部",
    trackandfield: "陸上部",
    Kendo: "剣道部",
    brassband: "吹奏楽部",
    manufacturingdepartment: "モノづくり部"
  };

  document.getElementById("clubTitle").textContent = `${clubTitleMap[clubName] || "在庫管理"} 用 在庫管理`;

  let items = [];

  function saveItems() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  }

  function loadItems() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      try {
        items = JSON.parse(data);
      } catch {
        items = [];
      }
    } else {
      items = [];
    }
  }

  function render(displayItems = items) {
    const tbody = document.querySelector('#inventory tbody');
    tbody.innerHTML = '';
    displayItems.forEach((item, i) => {
      const shortageClass = item.qty < item.requiredQty ? 'shortage' : '';
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.name}</td>
        <td class="${shortageClass}">${item.qty}</td>
       <td>
  <input type="number" id="required_${i}" value="${item.requiredQty}" min="0" style="width:70px;" />
  <button class="update-button" onclick="updateRequiredQty(${i})">更新</button>
</td>
<td>
  <input type="number" id="in_${i}" min="0" value="0" />
  <button class="add-button" onclick="addStock(${i})">入荷</button>
</td>
<td>
  <input type="number" id="out_${i}" min="0" value="0" />
  <button class="consume-button" onclick="consumeStock(${i})">消費</button>
</td>
<td>
  <button class="remove-button" onclick="removeItem(${i})">削除</button>
</td>
      `;
      tbody.appendChild(tr);
    });
    saveItems();
  }

  function addItem() {
    const name = document.getElementById('newName').value.trim();
    const qty = parseInt(document.getElementById('newQty').value);
    const requiredQty = parseInt(document.getElementById('newRequiredQty').value);
    if (!name || isNaN(qty) || isNaN(requiredQty)) {
      alert('正しく入力してください');
      return;
    }
    items.push({ name, qty, requiredQty });
    render();
    document.getElementById('newName').value = '';
    document.getElementById('newQty').value = '';
    document.getElementById('newRequiredQty').value = '';
  }

  function updateRequiredQty(index) {
    const input = document.getElementById(`required_${index}`);
    const val = parseInt(input.value);
    if (!isNaN(val) && val >= 0) {
      items[index].requiredQty = val;
      render();
    }
  }

  function addStock(index) {
    const input = document.getElementById(`in_${index}`);
    const val = parseInt(input.value);
    if (!isNaN(val) && val > 0) {
      items[index].qty += val;
      input.value = 0;
      render();
    }
  }

  function consumeStock(index) {
    const input = document.getElementById(`out_${index}`);
    const val = parseInt(input.value);
    if (!isNaN(val) && val > 0 && items[index].qty >= val) {
      items[index].qty -= val;
      input.value = 0;
      render();
    }
  }

  function removeItem(index) {
    if (confirm(`「${items[index].name}」を削除しますか？`)) {
      items.splice(index, 1);
      render();
    }
  }

  function showShortage() {
    const filtered = items.filter(item => item.qty < item.requiredQty);
    render(filtered);
  }

  function showAll() {
    render();
  }

  loadItems();
  render();
</script>

</body>
</html>





<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>在庫管理</title>
  <link rel="stylesheet" href="style.css" />
</head>
